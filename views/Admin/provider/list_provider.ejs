<div class="main-content">
  <section class="section">
    <div class="section-header">
      <h1>Individual Providers</h1>
      <div class="section-header-breadcrumb">
        <div class="breadcrumb-item active"><a href="/admin/dashboard">Dashboard</a></div>
        <div class="breadcrumb-item">Individual Providers</div>
      </div>

    </div>
    <div class="section-body">
      <div class="col-12 col-md-6 col-lg-12">
        <div class="table-responsive">
          <table id="myTable" class="table table-hover table-md">
            <thead>
              <tr style="background-color: #ebf2f2;">
                <th scope="col">S No.</th>
                <th scope="col">Image</th>
                <th scope="col">Name</th>
                <th scope="col">Email</th>
                <!-- <th scope="col">ID Proof</th> -->
                <th scope="col">Is Approved</th>
                <!-- <th scope="col">Portal</th> -->
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody>
              <% if(providerdate.length !=0){%>
              <% providerdate.forEach(function(data,i) { %>
              <tr>
                <td>
                  <%=1+i%>
                </td>
                <% if(data.image !='' ) { %>
                <td> <img alt="" width="50" height="50" id="blah" src="<%=data.image%>" class="profile_img rounded-circle"></td>
                <% } else { %>
                <td> <img src="/assets/img/defaultimage.jpg" width="50" height="50" id="blah" class="profile_img rounded-circle" alt=""></td>
                <% } %>

                <td>
                  <%=data.name%>
                </td>
                <td>
                  <%=data.email%>
                </td>


                <!-- <td>
                          <img src="<%=data.idproof%>" width="45px" height="40px" type="submit" style="cursor:pointer;">
                        </td> -->
                <td>
                  <select onchange="changeStatus(this,'<%= data.id %>')" class="btn btn-sm <%= data.status==0?'btn-danger':data.status==1?'btn-success':'btn-warning'
                              %> status">
                    <option class="btn-danger" value="0" <%=data.status==0?"selected":"" %>>Pending</option>
                    <option class="btn-success" value="1" <%=data.status==1?"selected":"" %>>Approved</option>
                    <option class="btn-warning" value="2" <%=data.status==2?"selected":"" %>>Not Approved
                    </option>
                  </select>

                  <!-- <% if(data.status==1) { %>
                              <button onclick="changeStatus(this)" id="userId_<%-data.id%>"
                                class=" btn btn-sm btn-success status " data-id="<%=data._id%>"
                                value="0">Active</button>
                              <% } else { %>
                                <button onclick="changeStatus(this)" id="userId_<%-data.id%>"
                                  class="btn btn-sm btn-danger status" data-id="<%=data._id%>"
                                  value="1">In-Active</button>
                                <% } %> -->
                </td>
                <!-- <td>
                          <a href="/view_portal/<%=data._id%>" class=" btn btn-sm btn-success status " style="background-color: var(--theme);" >Portal</a>
                        </td> -->
                <td>
                  <a href="/admin/view_provider/<%=data._id%>" class="btn btn-sm bg-warning"><i class="fa fa-eye" aria-hidden="true"></i></a>
                  <!-- <a href="/edit_worker/<%=data._id%>" class="btn btn-sm bg-warning"><i
                              class="fas fa-edit"></i></a> -->
                  <button onclick="confirmDelete('<%=data._id%>')" class="btn btn-sm bg-danger"> <i class="fa fa-trash"></i> </button>
                </td>
              </tr>
              <%})%>
              <%}%>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
</div>


<script>

  $(document).ready(function () {
    $('#myTable').DataTable({
      dom: 'Bfrtip',
      buttons: [
        'excel', 'pdf', 'print'
      ]
    });
  });

  setTimeout(function () {
    $("div.msg").fadeOut();
  }, 2000);
</script>

<script>
  $(document).ready(function () {
    // alert("ready!");
  });

  // function confirmDelete(id) {
  //   console.log(">>>>>>>>done>>>>>>>>>>", id)
  //   $.ajax({
  //         url: `/admin/check_provider_booking_status/${id}`,
  //         type: 'post',
  //         data: {
  //           id: id
  //         },
  //         success: function (result) {
  //           if(result){
  //             const swalWithBootstrapButtons = Swal.mixin({
  //               customClass: {
  //                 confirmButton: 'btn btn-warning',
  //                 cancelButton: 'btn btn-info'
  //               },
  //               buttonsStyling: true
          
  //             })
          
  //             // console.log("------------------------------result------", id);
          
  //             swalWithBootstrapButtons.fire({
  //               title: 'Are you sure?',
  //               text: "You won't be able to revert this!",
  //               icon: 'warning',
  //               showCancelButton: true,
  //               confirmButtonText: 'Yes, delete it!',
  //               cancelButtonText: 'No, cancel!',
  //               reverseButtons: true
  //             }).then((isConfirm) => {
  //               // console.log(isConfirm)
  //               // return
  //               if (isConfirm.isConfirmed) {
  //                 // alert('asd')
  //                 $.ajax({
  //                   url: "/admin/delete_provider/:id",
  //                   type: 'delete',
  //                   data: {
  //                     id: id
  //                   },
  //                   success: function (result) { }
  //                 });
  //                 swalWithBootstrapButtons.fire(
  //                   'Deleted!',
  //                   'The Provider has been deleted .',
  //                   'success'
  //                 ).then(() => {
  //                   location.reload();
  //                 })
  //               } else {
  //                 swalWithBootstrapButtons.fire(
  //                   'Cancelled',
  //                   'The Provider is safe :)',
  //                   'error'
  //                 )
  //               }
  //             })
  //            }else{
  //             console.log('ininfff')
  //             const swalWithBootstrapButtons = Swal.mixin({
  //               customClass: {
  //                 confirmButton: 'btn btn-warning',
  //                 // cancelButton: 'btn btn-info'
  //               },
  //               buttonsStyling: true
          
  //             })

  //             swalWithBootstrapButtons.fire({
  //               title: 'Are you sure?',
  //               text: "You won't be able to revert this!",
  //               icon: 'warning',
  //               showCancelButton: true,
  //               // confirmButtonText: 'Yes, delete it!',
  //               cancelButtonText: 'Ok!',
  //               reverseButtons: true
  //             }).then((isConfirm) => {
  //               // console.log(isConfirm)
  //               // return
  //               if (isConfirm.isConfirmed) {
  //                 // alert('asd')
  //                 $.ajax({
  //                   url: "/admin/delete_provider/:id",
  //                   type: 'delete',
  //                   data: {
  //                     id: id
  //                   },
  //                   success: function (result) { }
  //                 });
  //                 swalWithBootstrapButtons.fire(
  //                   'Deleted!',
  //                   'The Provider has been deleted .',
  //                   'success'
  //                 ).then(() => {
  //                   location.reload();
  //                 })
  //               } else {
  //                 swalWithBootstrapButtons.fire(
  //                   'Cancelled',
  //                   'The Provider is safe :)',
  //                   'error'
  //                 )
  //               }
  //             })
  //            }
  //           }
  //       });

  // }

  function confirmDelete(id) {
    console.log(">>>>>>>>done>>>>>>>>>>", id);
    $.ajax({
        url: `/admin/check_provider_booking_status/${id}`,
        type: 'POST',
        data: { id: id },
        success: function (result) {
          console.log('result: ', result);
            const swalWithBootstrapButtons = Swal.mixin({
                customClass: {
                    confirmButton: 'btn btn-warning',
                    cancelButton: 'btn btn-info'
                },
                buttonsStyling: true
            });

            if (result) {
                swalWithBootstrapButtons.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, delete it!',
                    cancelButtonText: 'No, cancel!',
                    reverseButtons: true
                }).then((isConfirm) => {
                    if (isConfirm.isConfirmed) {
                        $.ajax({
                            url: `/admin/delete_provider/${id}`,
                            type: 'DELETE',
                            data: { id: id },
                            success: function (result) {
                                swalWithBootstrapButtons.fire(
                                    'Deleted!',
                                    'The Provider has been deleted.',
                                    'success'
                                ).then(() => {
                                    location.reload();
                                });
                            },
                            error: function (error) {
                                swalWithBootstrapButtons.fire(
                                    'Error!',
                                    'An error occurred while deleting the provider.',
                                    'error'
                                );
                            }
                        });
                    } else {
                        swalWithBootstrapButtons.fire(
                            'Cancelled',
                            'The Provider is safe :)',
                            'error'
                        );
                    }
                });
            } else {
                swalWithBootstrapButtons.fire({
                    title: 'Cannot Delete',
                    text: "There are pending bookings for this provider.",
                    icon: 'warning',
                    confirmButtonText: 'Ok',
                    buttonsStyling: true
                });
            }
        },
        error: function (error) {
            swalWithBootstrapButtons.fire(
                'Error!',
                'An error occurred while checking the booking status.',
                'error'
            );
        }
    });
}

</script>


<script>
  function changeStatus(val, id) {
    $.ajax({
      type: "post",
      url: "/admin/provider_status",
      data: {
        id: id,
        value: val.value
      },
      success: function (data) {

        console.log(data, "???????????????????????????????????")
        if (data == 1) {
          window.location.reload()
        }


        // if (data) {
        //   elemID.setAttribute('value', 0)
        //   // elemID.innerText = `active`
        //   elemID.classList.remove('btn-danger')
        //   elemID.classList.add('btn-success')
        // } else {
        //   elemID.setAttribute('value', 1)
        //   // elemID.innerText = `in-active`
        //   elemID.classList.remove('btn-success')
        //   elemID.classList.add('btn-danger')
        // }
        // window.location.reload();
      }
    });
  }
</script>