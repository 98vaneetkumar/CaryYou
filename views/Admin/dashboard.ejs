<div class="main-content">
  <section class="section">
    <div class="section-header">
      <div class="d-flex justify-content-between align-items-center w-100">
        <h1>Admin Dashboard</h1>
        <div class="filter-options">
          <select id="filter" class="form-control">
            <option value="all">All</option>
            <option value="today">Today</option>
            <option value="weekly">This Week</option>
            <option value="monthly">This Month</option>
            <option value="3months">Last 3 Months</option>
            <option value="6months">Last 6 Months</option>
            <option value="1year">Last 1 Year</option>
            <option value="5years">Last 5 Years</option>
          </select>
        </div>
      </div>
    </div>
    <div class="row">
      <!-- Users Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-top">
        <a href="/admin/user_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #66e8ff, #9999ff)"
          >
            <div class="card-icon" style="background: rgba(56, 56, 187, 0.8)">
              <i class="fas fa-users"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold"><b>Users</b></h4>
              </div>
              <div class="card-body" id="user" value="<%= user %>" style="color: white; font-weight: bold">
                <%= user %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Providers (Restaurants) Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-top">
        <a href="/admin/restaurant_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #33cccc, #66cccc)"
          >
            <div class="card-icon" style="background: rgba(38, 152, 152, 0.8)">
              <i class="fas fa-utensils"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">
                  <b>Providers/Restaurant</b>
                </h4>
              </div>
              <div class="card-body" id="provider" value="<%= provider %>" style="color: white; font-weight: bold">
                <%= provider %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Riders Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-top">
        <a href="/admin/rider_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #33cc99, #66cc99)"
          >
            <div class="card-icon" style="background: rgba(38, 151, 114, 0.8)">
              <i class="fas fa-taxi"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold"><b>Riders</b></h4>
              </div>
              <div class="card-body" id="rider" value="<%= rider %>" style="color: white; font-weight: bold">
                <%= rider %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Vehicle Types Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-top">
        <a href="/admin/vehicleType_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #3399ff, #66ccff)"
          >
            <div class="card-icon" style="background: rgba(38, 151, 219, 0.8)">
              <i class="fas fa-car-side"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">
                  <b>Vehicle Types</b>
                </h4>
              </div>
              <div class="card-body" id="vehicleType" value="<%= vehicleType %>" style="color: white; font-weight: bold">
                <%= vehicleType %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Payments Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-left">
        <a href="#">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #db952d, #66ccff)"
          >
            <div class="card-icon" style="background: rgba(38, 151, 219, 0.8)">
              <i class="fas fa-credit-card"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold"><b>Payments</b></h4>
              </div>
              <div class="card-body" id="payments" value="<%= payments %>"  style="color: white; font-weight: bold">
                <%= payments %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Orders Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-left">
        <a href="/admin/order_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #33cc33, #66ff66)"
          >
            <div class="card-icon" style="background: rgba(44, 176, 44, 0.8)">
              <i class="fas fa-box"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold"><b>Orders</b></h4>
              </div>
              <div class="card-body" id="orders" value="<%= orders %>" style="color: white; font-weight: bold">
                <%= orders %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Pending order -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-right ">
        <a href="/admin/pending_order_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #ffcc00, #ff6f00)"
          >
            <div class="card-icon" style="background: rgba(255, 153, 0, 0.8)">
              <i class="fas fa-clock"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">
                  <b>Pending Orders</b>
                </h4>
              </div>
              <div
                class="card-body"
                id="pendingOrders"
                value="<%= pendingOrders %>"
                style="color: white; font-weight: bold"
              >
                <%= pendingOrders %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Active Orders -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-right">
        <a href="/admin/active_order_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #ff5733, #ff8c66)"
          >
            <div class="card-icon" style="background: rgba(204, 85, 51, 0.8)">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">Active Orders</h4>
              </div>
              <div class="card-body"  id="activeOrders" value="<%= activeOrders %>" style="color: white; font-weight: bold">
                <%= activeOrders %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Delivered Orders -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-left">
        <a href="/admin/delivered_order_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #2081d7, #4e89b0)"
          >
            <div class="card-icon" style="background: rgba(34, 101, 167, 0.8)">
              <i class="fas fa-truck"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">
                  Delivered Orders
                </h4>
              </div>
              <div class="card-body"   id="deliveredOrders" value="<%= deliveredOrders %>" style="color: white; font-weight: bold">
                <%= deliveredOrders %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Cancelled Orders -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-left">
        <a href="/admin/cancel_order_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #ffc300, #ffd966)"
          >
            <div class="card-icon" style="background: rgba(204, 153, 51, 0.8)">
              <i class="fas fa-ban"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">
                  Cancelled/Rejected Orders
                </h4>
              </div>
              <div class="card-body" id="cancelledOrders" style="color: white; font-weight: bold">
                <%= cancelledOrders %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Services Card -->
<div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-right">
  <a href="/admin/service_list">
    <div
      class="card card-statistic-1"
      style="background: linear-gradient(135deg, #ff9966, #ffcc66)"
    >
      <div class="card-icon" style="background: rgba(255, 165, 0, 0.8)">
        <i class="fas fa-clipboard-list"></i>
      </div>
      <div class="card-wrap">
        <div class="card-header">
          <h4 style="color: white; font-weight: bold"><b>Services</b></h4>
        </div>
        <div class="card-body" id="servicesData" style="color: white; font-weight: bold">
          <%= servicesData %>
        </div>
      </div>
    </div>
  </a>
</div>

<!-- Feedback Card -->
<div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-right">
  <a href="/admin/feedback_list">
    <div
      class="card card-statistic-1"
      style="background: linear-gradient(135deg, #ff6699, #ff99cc)"
    >
      <div class="card-icon" style="background: rgba(255, 82, 129, 0.8)">
        <i class="fas fa-comment-alt"></i>
      </div>
      <div class="card-wrap">
        <div class="card-header">
          <h4 style="color: white; font-weight: bold"><b>Feedback</b></h4>
        </div>
        <div class="card-body" id="feedbacks" style="color: white; font-weight: bold">
          <%= feedbacks %>
        </div>
      </div>
    </div>
  </a>
</div>

<!-- Contact Us Card -->
<div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-down">
  <a href="/admin/contact_us">
    <div
      class="card card-statistic-1"
      style="background: linear-gradient(135deg, #33cc66, #66ff99)"
    >
      <div class="card-icon" style="background: rgba(44, 176, 44, 0.8)">
        <i class="far fa-address-book"></i>
      </div>
      <div class="card-wrap">
        <div class="card-header">
          <h4 style="color: white; font-weight: bold">
            <b>Contact Us</b>
          </h4>
        </div>
        <div class="card-body" id="contactUs" style="color: white; font-weight: bold">
          <%= contactUs %>
        </div>
      </div>
    </div>
  </a>
</div>
    </div>
  </section>

  <div class="row">
    <!-- Graph for Users, Riders, and Restaurants -->
    <div class="col-lg-6 col-md-12">
      <div class="card">
        <div class="card-header">
          <h4 style="font-weight: bold; color: #333">Users, Riders, and Restaurants</h4>
        </div>
        <div class="card-body">
          <canvas id="userGraph"></canvas>
        </div>
      </div>
    </div>
  
    <!-- Graph for Order Status (Pending, Delivered, Cancelled) -->
    <div class="col-lg-6 col-md-12">
      <div class="card">
        <div class="card-header">
          <h4 style="font-weight: bold; color: #333">Order Status</h4>
        </div>
        <div class="card-body">
          <canvas id="orderStatusGraph"></canvas>
        </div>
      </div>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Example of setting up a chart for Users, Riders, and Restaurants
    var ctx1 = document.getElementById('userGraph').getContext('2d');
    var userGraph = new Chart(ctx1, {
      type: 'bar', // You can change to 'line', 'pie', etc.
      data: {
        labels: ['Users', 'Riders', 'Restaurants'],
        datasets: [{
          label: 'Count',
          data: [1200, 800, 400], // Example data
          backgroundColor: 'rgba(75, 192, 192, 0.6)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  
    // Example of setting up a chart for Order Status (Pending, Delivered, Cancelled)
    var ctx2 = document.getElementById('orderStatusGraph').getContext('2d');
    var orderStatusGraph = new Chart(ctx2, {
      type: 'pie', // You can change to 'bar', 'line', etc.
      data: {
        labels: ['Pending', 'Delivered', 'Cancelled'],
        datasets: [{
          label: 'Order Status',
          data: [500, 1200, 200], // Example data
          backgroundColor: [
            'rgba(255, 159, 64, 0.6)', // Pending (orange)
            'rgba(75, 192, 192, 0.6)', // Delivered (green)
            'rgba(255, 99, 132, 0.6)'  // Cancelled (red)
          ],
          borderColor: [
            'rgba(255, 159, 64, 1)', // Pending
            'rgba(75, 192, 192, 1)', // Delivered
            'rgba(255, 99, 132, 1)'  // Cancelled
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'top'
          },
          tooltip: {
            callbacks: {
              label: function(tooltipItem) {
                return tooltipItem.label + ': ' + tooltipItem.raw + ' Orders';
              }
            }
          }
        }
      }
    });
  </script>
  




<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const filterDropdown = document.getElementById("filter");

    // Listen for dropdown changes
    filterDropdown.addEventListener("change", async () => {
      const selectedFilter = filterDropdown.value;
      const response = await fetch("/admin/dashboardFilter", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ filter: selectedFilter }),
      });

      const data = await response.json();
      document.getElementById("user").textContent=data.user;
      document.getElementById("provider").textContent=data.provider;
      document.getElementById("rider").textContent=data.rider;
      document.getElementById("vehicleType").textContent=data.vehicleType;
      document.getElementById("orders").textContent=data.orders;
      document.getElementById("payments").textContent=data.payments;
      document.getElementById("feedbacks").textContent=data.feedbacks;
      document.getElementById("pendingOrders").textContent=data.pendingOrders;

      document.getElementById("activeOrders").textContent=data.activeOrders;
      document.getElementById("deliveredOrders").textContent=data.deliveredOrders;
      document.getElementById("cancelledOrders").textContent=data.cancelledOrders;
      document.getElementById("contactus").textContent=data.contactus;
      document.getElementById("servicesData").textContent=data.servicesData;
    });
  });
</script>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  socket.on('updateUserCount', (data) => {
    document.getElementById('user').textContent = data.user;
  });
</script>


<script>
  document.addEventListener("DOMContentLoaded", async () => {
  const userGraphCtx = document.getElementById("userGraph").getContext("2d");
  const orderGraphCtx = document.getElementById("orderGraph").getContext("2d");
  let userCount= document.getElementById("user").textContent
  let riderCount= document.getElementById("rider").textContent 
  let providerCount= document.getElementById("provider").textContent 
  let pendindOrderCount=document.getElementById("pendingOrders").textContent
  let activeOrderCount=document.getElementById("activeOrders").textContent
  let deliveredOrderCount=document.getElementById("deliveredOrders").textContent
  let cancelledOrderCount=document.getElementById("cancelledOrders").textContent
  console.log("userCount: ", userCount)
  // Initialize graphs with empty data
  let userGraph = new Chart(userGraphCtx, {
    type: "bar",
    data: {
      labels: ["Users", "Riders", "Restaurants"],
      datasets: [
        {
          label: "Count",
          data: [userCount, riderCount, providerCount], // Initial data
          backgroundColor: ["#6666ff", "#33cc99", "#33cccc"],
          borderColor: ["#4444ff", "#33aa99", "#33aaaa"],
          borderWidth: 1,
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: { display: true, text: "Users, Riders, and Restaurants" },
      },
    },
  });

  let orderGraph = new Chart(orderGraphCtx, {
    type: "doughnut",
    data: {
      labels: ["Active Orders", "Delivered Orders", "Cancelled Orders", "Pending Orders"],
      datasets: [
        {
          label: "Orders",
          data: [activeOrderCount, deliveredOrderCount, cancelledOrderCount, pendindOrderCount], // Initial data
          backgroundColor: ["#ff5733", "#33a1ff", "#ffc300", "#ffcc00"],
          borderColor: ["#cc4225", "#267fbf", "#bf9e00", "#cc9900"],
          borderWidth: 1,
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: "bottom" },
        title: { display: true, text: "Order Statistics" },
      },
    },
  });

  // Fetch and update graphs when the filter dropdown changes
  document.getElementById("filter").addEventListener("change", async () => {
    const selectedFilter = document.getElementById("filter").value;
    const response = await fetch("/admin/dashboardFilter", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ filter: selectedFilter }),
    });

    const data = await response.json();
    console.log("data data",data)

    // Update data for Users, Riders, and Restaurants
    userGraph.data.datasets[0].data = [
      data.user || 0,
      data.rider || 0,
      data.provider || 0,
    ];
    userGraph.update();

    // Update data for Orders
    orderGraph.data.datasets[0].data = [
      data.activeOrders || 0,
      data.deliveredOrders || 0,
      data.cancelledOrders || 0,
      data.pendingOrders || 0,
    ];
    orderGraph.update();
  });

  // Listen for live updates via Socket.IO
  const socket = io();
  socket.on("updateDashboard", (dashboardData) => {
    // Update data for Users, Riders, and Restaurants
    userGraph.data.datasets[0].data = [
      dashboardData.user || 0,
      dashboardData.rider || 0,
      dashboardData.provider || 0,
    ];
    userGraph.update();

    // Update data for Orders
    orderGraph.data.datasets[0].data = [
      dashboardData.activeOrders || 0,
      dashboardData.deliveredOrders || 0,
      dashboardData.cancelledOrders || 0,
      dashboardData.pendingOrders || 0,
    ];
    orderGraph.update();
  });
});

</script>
