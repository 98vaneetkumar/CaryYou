<div class="main-content">
  <section class="section">
    <div class="section-header">
      <div class="d-flex justify-content-between align-items-center w-100">
        <h1>Admin Dashboard</h1>
        <div class="filter-options">
          <select id="filter" class="form-control">
            <option value="all">All</option>
            <option value="today">Today</option>
            <option value="weekly">This Week</option>
            <option value="monthly">This Month</option>
            <option value="3months">Last 3 Months</option>
            <option value="6months">Last 6 Months</option>
            <option value="1year">Last 1 Year</option>
            <option value="5years">Last 5 Years</option>
          </select>
        </div>
      </div>
    </div>
    <div class="row">
      <div id="loader" class="setting-gear-loader" style="display: none">
        <div class="gear"></div>
      </div>
      <!-- Users Card -->

      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-top">
        <a href="/admin/user_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #66e8ff, #9999ff)"
          >
            <div class="card-icon" style="background: rgba(56, 56, 187, 0.8)">
              <i class="fas fa-users"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold"><b>Users</b></h4>
              </div>
              <div
                class="card-body"
                id="user"
                value="<%= user %>"
                style="color: white; font-weight: bold"
              >
                <%= user %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Providers (Restaurants) Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-top">
        <a href="/admin/restaurant_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #33cccc, #66cccc)"
          >
            <div class="card-icon" style="background: rgba(38, 152, 152, 0.8)">
              <i class="fas fa-utensils"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">
                  <b>Providers/Restaurant</b>
                </h4>
              </div>
              <div
                class="card-body"
                id="provider"
                value="<%= provider %>"
                style="color: white; font-weight: bold"
              >
                <%= provider %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Riders Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-top">
        <a href="/admin/rider_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #33cc99, #66cc99)"
          >
            <div class="card-icon" style="background: rgba(38, 151, 114, 0.8)">
              <i class="fas fa-taxi"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold"><b>Riders</b></h4>
              </div>
              <div
                class="card-body"
                id="rider"
                value="<%= rider %>"
                style="color: white; font-weight: bold"
              >
                <%= rider %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Vehicle Types Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-top">
        <a href="/admin/vehicleType_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #3399ff, #66ccff)"
          >
            <div class="card-icon" style="background: rgba(38, 151, 219, 0.8)">
              <i class="fas fa-car-side"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">
                  <b>Vehicle Types</b>
                </h4>
              </div>
              <div
                class="card-body"
                id="vehicleType"
                value="<%= vehicleType %>"
                style="color: white; font-weight: bold"
              >
                <%= vehicleType %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Payments Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-left">
        <a href="#">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #2ddbb8, #66ccff)"
          >
            <div class="card-icon" style="background: rgba(38, 151, 219, 0.8)">
              <i class="fas fa-credit-card"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold"><b>Payments</b></h4>
              </div>
              <div
                class="card-body"
                id="payments"
                value="<%= payments %>"
                style="color: white; font-weight: bold"
              >
                <%= payments %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Orders Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-left">
        <a href="/admin/order_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #33cc33, #66ff66)"
          >
            <div class="card-icon" style="background: rgba(44, 176, 44, 0.8)">
              <i class="fas fa-box"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold"><b>Orders</b></h4>
              </div>
              <div
                class="card-body"
                id="orders"
                value="<%= orders %>"
                style="color: white; font-weight: bold"
              >
                <%= orders %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Pending order -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-right">
        <a href="/admin/pending_order_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #ffcc00, #ff6f00)"
          >
            <div class="card-icon" style="background: rgba(255, 153, 0, 0.8)">
              <i class="fas fa-clock"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">
                  <b>Pending Orders</b>
                </h4>
              </div>
              <div
                class="card-body"
                id="pendingOrders"
                value="<%= pendingOrders %>"
                style="color: white; font-weight: bold"
              >
                <%= pendingOrders %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Active Orders -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-right">
        <a href="/admin/active_order_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #ff5733, #ff8c66)"
          >
            <div class="card-icon" style="background: rgba(204, 85, 51, 0.8)">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">Active Orders</h4>
              </div>
              <div
                class="card-body"
                id="activeOrders"
                value="<%= activeOrders %>"
                style="color: white; font-weight: bold"
              >
                <%= activeOrders %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Delivered Orders -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-left">
        <a href="/admin/delivered_order_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #2081d7, #4e89b0)"
          >
            <div class="card-icon" style="background: rgba(34, 101, 167, 0.8)">
              <i class="fas fa-truck"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">
                  Delivered Orders
                </h4>
              </div>
              <div
                class="card-body"
                id="deliveredOrders"
                value="<%= deliveredOrders %>"
                style="color: white; font-weight: bold"
              >
                <%= deliveredOrders %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Cancelled Orders -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-left">
        <a href="/admin/cancel_order_list">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #ffc300, #ffd966)"
          >
            <div class="card-icon" style="background: rgba(204, 153, 51, 0.8)">
              <i class="fas fa-ban"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">
                  Cancelled/Rejected Orders
                </h4>
              </div>
              <div
                class="card-body"
                id="cancelledOrders"
                style="color: white; font-weight: bold"
              >
                <%= cancelledOrders %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Services Card -->
      <!-- <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-right">
  <a href="#">
    <div
      class="card card-statistic-1"
      style="background: linear-gradient(135deg, #ff9966, #ffcc66)"
    >
      <div class="card-icon" style="background: rgba(255, 165, 0, 0.8)">
        <i class="fas fa-clipboard-list"></i>
      </div>
      <div class="card-wrap">
        <div class="card-header">
          <h4 style="color: white; font-weight: bold"><b>Services</b></h4>
        </div>
        <div class="card-body" id="servicesData" style="color: white; font-weight: bold">
          <%= servicesData %>
        </div>
      </div>
    </div>
  </a>
</div> -->

      <!-- Feedback Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-right">
        <a href="#">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #ff6699, #ff99cc)"
          >
            <div class="card-icon" style="background: rgba(255, 82, 129, 0.8)">
              <i class="fas fa-comment-alt"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold"><b>Feedback</b></h4>
              </div>
              <div
                class="card-body"
                id="feedbacks"
                style="color: white; font-weight: bold"
              >
                <%= feedbacks %>
              </div>
            </div>
          </div>
        </a>
      </div>

      <!-- Contact Us Card -->
      <div class="col-lg-3 col-md-6 col-sm-6 col-12 animate-right">
        <a href="#">
          <div
            class="card card-statistic-1"
            style="background: linear-gradient(135deg, #33cc66, #66ff99)"
          >
            <div class="card-icon" style="background: rgba(44, 176, 44, 0.8)">
              <i class="far fa-address-book"></i>
            </div>
            <div class="card-wrap">
              <div class="card-header">
                <h4 style="color: white; font-weight: bold">
                  <b>Contact Us</b>
                </h4>
              </div>
              <div
                class="card-body"
                id="contactUs"
                style="color: white; font-weight: bold"
              >
                <%= contactUs %>
              </div>
            </div>
          </div>
        </a>
      </div>
    </div>
  </section>

  <div class="row">
    <!-- Graph for Users, Riders, and Restaurants -->
    <div class="col-lg-6 col-md-12">
      <div class="card">
        <div class="card-header">
          <h4 style="font-weight: bold; color: #333">
            Users, Riders, and Restaurants
          </h4>
        </div>
        <div class="card-body">
          <canvas id="userGraph"></canvas>
        </div>
      </div>
    </div>

    <!-- Graph for Order Status (Pending, Delivered, Cancelled) -->
    <div class="col-lg-6 col-md-12">
      <div class="card">
        <div class="card-header">
          <h4 style="font-weight: bold; color: #333">Order Status</h4>
        </div>
        <div class="card-body">
          <canvas id="orderStatusGraph"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // Initialize values from existing HTML content
    let userCount = parseInt(document.getElementById("user").textContent) || 0;
    let riderCount =
      parseInt(document.getElementById("rider").textContent) || 0;
    let providerCount =
      parseInt(document.getElementById("provider").textContent) || 0;
    let pendingOrderCount =
      parseInt(document.getElementById("pendingOrders").textContent) || 0;
    let activeOrderCount =
      parseInt(document.getElementById("activeOrders").textContent) || 0;
    let deliveredOrderCount =
      parseInt(document.getElementById("deliveredOrders").textContent) || 0;
    let cancelledOrderCount =
      parseInt(document.getElementById("cancelledOrders").textContent) || 0;

    const filterDropdown = document.getElementById("filter");
    const loader = document.getElementById("loader");

    // Show loader
    function showLoader() {
      loader.style.display = "block";
    }

    // Hide loader
    function hideLoader() {
      loader.style.display = "none";
    }
    // Chart instances
    let userGraph, orderStatusGraph;

    // Function to initialize the charts
    function initializeCharts() {
      const ctx1 = document.getElementById("userGraph").getContext("2d");
      const ctx2 = document.getElementById("orderStatusGraph").getContext("2d");

      // User, Rider, Provider chart
      // User Graph (Bar Chart)
      userGraph = new Chart(ctx1, {
        type: "bar",
        data: {
          labels: ["Users", "Riders", "Restaurants"],
          datasets: [
            {
              label: "Count",
              data: [userCount, riderCount, providerCount],
              backgroundColor: [
                "rgba(102, 232, 255, 1)", // Users (matches gradient from #66e8ff to #9999ff)
                "rgba(51, 204, 153, 1)", // Riders (matches gradient from #33cc99 to #66cc99)
                "rgba(51, 204, 204, 1)", // Restaurants (matches gradient from #33cccc to #66cccc)
              ],
              borderColor: [
                "rgba(102, 232, 255, 1)", // Users (same as background)
                "rgba(51, 204, 153, 1)", // Riders (same as background)
                "rgba(51, 204, 204, 1)", // Restaurants (same as background)
              ],
              borderWidth: 1,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            title: { display: true, text: "Users, Riders, and Restaurants" },
          },
          scales: {
            y: { beginAtZero: true },
          },
        },
      });

      // Order Status Chart (Pie Chart)
      orderStatusGraph = new Chart(ctx2, {
        type: "pie",
        data: {
          labels: ["Pending", "Delivered", "Cancelled"],
          datasets: [
            {
              label: "Order Status",
              data: [
                pendingOrderCount,
                deliveredOrderCount,
                cancelledOrderCount,
              ],
              backgroundColor: [
                "rgba(255, 153, 0, 1)", // Pending (matches container)
                "rgba(34, 101, 167, 1)", // Delivered (matches container)
                "rgba(255, 204, 102, 1)", // Cancelled (lighter gold)
              ],
              borderColor: [
                "rgba(255, 153, 0, 1)", // Pending (same as background)
                "rgba(34, 101, 167, 1)", // Delivered (same as background)
                "rgba(255, 204, 102, 1)", // Cancelled (same as background)
              ],
              borderWidth: 1,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: "top" },
            tooltip: {
              callbacks: {
                label: function (tooltipItem) {
                  return tooltipItem.label + ": " + tooltipItem.raw + " Orders";
                },
              },
            },
          },
        },
      });
    }

    // Function to fetch data and update charts
    async function fetchData(filter = null) {
      showLoader(); // Show loader before starting the fetch process

      try {
        const response = await fetch("/admin/dashboardFilter", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ filter }),
        });

        const data = await response.json();

        // Update text content
        document.getElementById("user").textContent = data.user || 0;
        document.getElementById("provider").textContent = data.provider || 0;
        document.getElementById("rider").textContent = data.rider || 0;
        document.getElementById("pendingOrders").textContent =
          data.pendingOrders || 0;
        document.getElementById("activeOrders").textContent =
          data.activeOrders || 0;
        document.getElementById("deliveredOrders").textContent =
          data.deliveredOrders || 0;
        document.getElementById("cancelledOrders").textContent =
          data.cancelledOrders || 0;

        // Update variables and charts
        userCount = data.user || 0;
        riderCount = data.rider || 0;
        providerCount = data.provider || 0;
        pendingOrderCount = data.pendingOrders || 0;
        activeOrderCount = data.activeOrders || 0;
        deliveredOrderCount = data.deliveredOrders || 0;
        cancelledOrderCount = data.cancelledOrders || 0;

        userGraph.data.datasets[0].data = [
          userCount,
          riderCount,
          providerCount,
        ];
        userGraph.update();

        orderStatusGraph.data.datasets[0].data = [
          pendingOrderCount,
          deliveredOrderCount,
          cancelledOrderCount,
        ];
        orderStatusGraph.update();
      } catch (error) {
        console.error("Error fetching data:", error);
      } finally {
        hideLoader(); // Always hide loader once fetch process is complete
      }
    }
    // Event listener for dropdown changes
    filterDropdown.addEventListener("change", async () => {
      const selectedFilter = filterDropdown.value;
      await fetchData(selectedFilter); // Fetch and update data based on filter
    });

    // Initialize charts and set initial data on page load
    document.addEventListener("DOMContentLoaded", () => {
      initializeCharts(); // Initialize charts
    });
  </script>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    socket.on("updateUserCount", (data) => {
      document.getElementById("user").textContent = data.user;
    });
  </script>
</div>
